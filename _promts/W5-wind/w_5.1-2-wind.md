# W5.1: QBlade (2h)

**Kierunek:** Odnawialne Źródła Energii (semestr 5)  
**Przedmiot:** Programy komputerowe w projektowaniu instalacji OZE  
**Prowadzący:** prof. (wykład praktyczny, demonstracyjny)  

---

## Spis treści
- [Wprowadzenie do projektowania turbin i farm wiatrowych](./01-wprowadzenie-farmy-wiatrowe.md)
- [Proces modelowania/projektowania turbin i farm wiatrowych](./02-proces-modelowania.md)

---

## 01 — Wprowadzenie do projektowania turbin i farm wiatrowych (QBlade)

### Cele zajęć
Po tym bloku student:
- rozumie miejsce **QBlade** w ekosystemie narzędzi wiatrowych (projekt turbiny, charakterystyki mocy/ciągu, wstępne analizy obciążeniowe),
- potrafi przygotować dane aerodynamiczne profilu (polary) i zbudować model łopaty w ujęciu **BEM** (Blade Element Momentum),
- potrafi wygenerować krzywe **Cp(λ)**, **Ct(λ)** i **P(v)** oraz wyeksportować **krzywą mocy** i **ciągu** do dalszego użycia (np. w narzędziach farmowych),
- zna podstawy symulacji nieustalonych i oceny obciążeń (moment u nasady, wychylenia, wstęp do DLC),
- rozumie jak z krzywej mocy i rozkładu wiatru uzyskać **AEP** i jak szacować **niepewność (P50/P90)**.

### Czym jest QBlade (z perspektywy projektanta)
- **Oprogramowanie specjalistyczne** do projektowania wirników i turbin wiatrowych (głównie **HAWT** – pozioma oś obrotu).  
- Integruje: generowanie **polarnych charakterystyk profili** (silnik podobny do XFoil), projekt łopaty, rozwiązanie **BEM** z korektami końcowymi (tip/root), modele przeciągnięcia dynamicznego, moduły symulacji nieustalonych i narzędzia raportowe.  
- Wynik pracy: **geometria łopaty**, **zespół turbiny**, krzywe **Cp, Ct, P**, rozkłady sił/obciążeń, pliki wynikowe **CSV** do dalszego użycia (np. w narzędziach farmowych i optymalizacji).

> **Uwaga dydaktyczna:** QBlade jest świetny do **projektu turbiny** i tworzenia **wiarygodnej krzywej mocy/ciągu**. Do pełnego modelowania farm (mikrolokalizacja, cienie/wiry, układ kablowy, ekonomia) stosujemy dodatkowe narzędzia, ale **wejściem** do nich są właśnie artefakty z QBlade.

### Ekosystem narzędzi — gdzie QBlade „wpina się” w łańcuch projektowy
- **Dane wiatrowe**: stacja pomiarowa (maszt, LiDAR) → rozkłady prędkości (Weibull), róża kierunkowa, **turbulence intensity TI**.  
- **QBlade**: projekt profili/łopaty/turbiny → **P(v)** i **Ct(v)**.  
- **Narzędzia farmowe** (omówimy w W6): model wirów (Jensen/Larsen/Gaussian), mikrolokalizacja, **AEP_farm** i straty układu.  
- **Ocena ekonomiczna**: CAPEX/OPEX, **LCOE** — wymaga **AEP** i matrixu strat.

### Minimalna teoria potrzebna do pracy z QBlade
- **BEM**: wirnik dzielimy na elementy; siły aerodynamiczne (z polarnych profili) równoważymy z pędem strumienia.  
- **Parametry projektowe**: **TSR = λ = ωR/V**, **Cp** (sprawność mocy), **Ct** (współczynnik ciągu), **solidity σ = B·c/(2πr)**.  
- **Polary profilu**: **Cl(α, Re)**, **Cd(α, Re)**, **Cm(α, Re)**; wpływ stanu powierzchni (gładkość, owady, oblodzenie).  
- **Korekty 3D**: straty końcowokrawędziowe (tip/root – **Prandtl**), korekta wysokiej indukcji (**Glauert/Buhl**), przeciągnięcie dynamiczne, skręcenie wiru w napływie skośnym (yaw/skewed wake).

### Interfejs QBlade: moduły i typowy przepływ pracy
1. **Airfoils → Polars**: definicja profili i liczby Reynoldsa; generacja oraz czyszczenie polarnych.  
2. **Blade Design**: liczba łopat, R, hub; rozkłady **chord(r)** i **twist(r)**; przydział profili wzdłuż promienia.  
3. **Rotor/Turbine**: składanie turbiny, strategia sterowania (stały kąt/pitch, regulacja prędkości), cut-in/rated/cut-out.  
4. **BEM Solvers**: krzywe **Cp(λ), Ct(λ), P(λ)** oraz **P(v)**.  
5. **Unsteady/Loads**: podmuchy, turbulencja, zmienność wiatru; ocena obciążeń i zachowania sterowania.  
6. **Export/Report**: krzywe do **CSV**, raport projektu, zrzuty wykresów.

### Jakość danych wejściowych — na co uważać
- **Reynolds** różny po promieniu i z prędkością → polary w kilku **Re**.  
- **Zakres α**: zapewnij pokrycie stanów przed/po przeciągnięciu (np. −12°…+22°).  
- **Wygładzanie polarnych**: usuń artefakty numeryczne; ciągłość krzywych kluczowa dla zbieżności BEM.  
- **TI i shear**: wpływają na obciążenia i aktywację sterowania (pitch/odcięcie). W QBlade modelujemy to scenariuszami nieustalonymi.

---

## 02 — Proces modelowania/projektowania turbin i farm wiatrowych (w QBlade)

> Poniżej **praktyczna checklista** z komentarzem. Pracujemy „od profilu do farmy”: polary → łopata → wirnik → turbina → krzywe → export → szkic farmy.

### Krok 0. Przygotowanie danych wejściowych
- **Warunki wiatrowe**: zakres prędkości (np. 3–25 m/s), rozkłady (Weibull k, c), róża kierunkowa, **TI** (np. 8–15% onshore), profil pionowy (shear exponent).  
- **Założenia projektowe**: moc docelowa (np. 100 kW / 3 MW), średnica wirnika, limit prędkości końcówki (akustyka/wytrzymałość), liczba łopat (3), filozofia sterowania (**stall**/ **pitch**, stało- vs zmiennoobrotowa), poziom hałasu.  
- **Biblioteka profili**: 2–4 rodziny profili dla różnych sekcji (root/mid/tip) o zróżnicowanym **t/c** i **Clmax**; przygotuj wielo-Re polary.

### Krok 1. Generowanie polarnych charakterystyk profili (Airfoils → Polars)
1. **Import/definicja geometrii** profilu (współrzędne x–y).  
2. **Ustawienia polarnych**: zakres **α** (np. −10°…+20°), poziomy **Re** odpowiadające sekcjom (np. 3e5, 8e5, 1.5e6, 3e6).  
3. **Higiena danych**: interpolacja braków, wygładzenie w rejonie przeciągnięcia; sprawdź monotoniczność **Cl(α)** w części przedkrytycznej.  
4. **Analiza jakości**: krzywe **L/D**; wybór profili dających wysokie L/D w środkowej sekcji i akceptowalne **Cd** w końcówce.  
**Efekt:** zestaw wiarygodnych polarnych dla wszystkich profili użytych na łopacie.

### Krok 2. Projekt łopaty (Blade Design)
1. **Topologia**: **B**, **R**, hub, **r_in** aktywnej części, ograniczenia montażowe/serwisowe.  
2. **Dobór profili po promieniu**: grube (nośność/struktura) w nasadzie, cieńsze ku końcówce (sprawność/hałas).  
3. **Rozkłady**: start z rozkładu teoretycznego dla **λ_design** (np. 6–8) i σ docelowej, potem korekty praktyczne.  
4. **Weryfikacja lokalna**: utrzymanie **Cl** w „słodkim punkcie” L/D dla zakresu prędkości; unikanie nadmiernych kątów w root.  
5. **Aspekty konstrukcyjne**: dopuszczalne ugięcia, marginesy na odkształcenia i luz do wieży; opcjonalnie definicja mas/inerencji dla analiz nieustalonych.  
**Efekt:** geometrycznie spójna łopata gotowa do obliczeń BEM.

### Krok 3. Złożenie wirnika i turbiny (Rotor/Turbine)
1. **Wirnik → Turbina**: dodaj hub, maszt, generator.  
2. **Strategia sterowania**:  
   - **Below rated**: sterowanie prędkością/ momentem tak, by utrzymać **λ ≈ λ_design**; typowo prawo **T = k·ω²** (MPPT).  
   - **Above rated**: **pitch control** utrzymujący moc znamionową (ogranicza **Ct** i hałas).  
3. **Parametry graniczne**: **cut-in**, **rated**, **cut-out**; limity RPM i **tip speed**; zabezpieczenia (hamulec, feather).  
4. **Krzywa generatora/inwertera**: definicja **P(ω)** lub krzywej momentu; zgrywanie z aerodynamiką, by uniknąć oscylacji.

### Krok 4. Symulacje ustalone (BEM Solvers)
1. **Krzywe charakterystyczne**: **Cp(λ)**, **Ct(λ)**, **P(λ)** — szukaj stabilnych, gładkich przebiegów.  
2. **Krzywa mocy P(v)**: wektor prędkości (np. 3–25 m/s co 0,5 m/s).  
3. **Analiza sprawności**: pozycja **Cp_max** (typowo 0,45–0,5 dla dobrych projektów HAWT); porównaj z celami.  
4. **Analiza ciągu**: zbyt wysokie **Ct** → rozważ korekty **twist/chord**, modyfikację sterowania w rated, albo nieco niższe **λ_design**.  
5. **Ustawienia solvera**: tolerancja zbieżności indukcji, włączenie modeli **Prandtl tip/root**, korekta **high-thrust**, w napływie skośnym korekta **skewed wake**.  
**Efekt:** gotowa krzywa mocy i ciągu — „dowód osobisty” turbiny.

### Krok 5. Symulacje nieustalone i obciążenia (Unsteady/Loads)
1. **Scenariusze wiatrowe**: podmuch schodkowy (gust), przebiegi TI, zmiany kierunku (yaw step), shear; analiza wejścia w rated i reakcji pitch.  
2. **Wyniki obciążeniowe**: moment u nasady, siły po promieniu, drgania skrętne; wstępna ocena zmęczeniowa (trend).  
3. **Modele dynamiczne**: aktywuj przeciągnięcie dynamiczne; obserwuj wpływ na amplitudy sił.  
4. **Stabilność sterowania**: unikanie „polowania” (oscylacji) pomiędzy regulacją prędkości a pitch; dostrajanie regulatorów.

### Krok 6. Export wyników (Power/Thrust Curves)
- Wyeksportuj **P(v)** i **Ct(v)** do **CSV**. Zachowaj jasne jednostki (m/s, kW, —) i gęstość powietrza użytą w obliczeniach.  
- Zachowaj **Cp(λ)** i **Ct(λ)** wraz z ustawieniami solvera dla replikowalności.  
- Dołącz parametry turbiny: **R, B, σ, λ_design, cut-in/rated/cut-out, prawa sterowania**.

### Krok 7. Od turbiny do farmy – jak wykorzystać wyniki QBlade
> QBlade nie jest pełnym narzędziem farmowym, ale dostarcza **kluczowych wejść**:
1. **Krzywa mocy P(v)** → wyznaczenie **AEP** z rozkładu prędkości; uwzględnij gęstość powietrza i korekty wysokości.  
2. **Krzywa ciągu Ct(v)** → parametryzacja zasięgu wiru w prostych modelach wake (np. stałego współczynnika ekspansji).  
3. **Warianty turbiny** (różne **λ_design**, pitch, liczba łopat) → porównanie **AEP** i przeciążeń przed decyzją layoutową.  
4. **Szacowanie strat** (szkic): dostępność, elektryczne, krzyżowanie kabli, ograniczenia środowiskowe/curtailment, oblodzenie, **wake losses**.  
5. **Niepewność**: zbilansuj źródła niepewności (wiatr, model, sterowanie) i oszacuj **P50/P90** — potrzebne do dialogu z inwestorem.

---

## Rozszerzenia zaawansowane (opcjonalnie na projekt/Koło Naukowe)

### A. Tuning modeli BEM i wpływ ustawień
- **Prandtl tip/root**: zawsze włącz; bez niego przeszacujesz **Cp**.  
- **Korekta wysokiej indukcji**: konieczna przy **Ct** zbliżającym się do 1; kontroluje realność rozwiązań.  
- **Yaw/skewed wake**: ważne przy niedokładnym ustawieniu azymutu/yawu lub w analizach farmowych.  
- **Rozdzielczość promieniowa**: więcej elementów w strefie 0,6–0,9 R (większy wkład do mocy).

### B. Projekt a hałas
- **Tip speed** i **końcówka** determinują emisję; ograniczaj **V_tip** w trybie rated.  
- **Twist/ chord końcówki**: delikatne korekty dają duże zmiany hałasu przy minimalnej stracie **Cp**.  
- **Pitch schedule**: łagodniejsza regulacja zmniejsza skoki akustyczne.

### C. Wrażliwość projektu (analiza parametryczna)
- Zmień **λ_design** o ±10% i obserwuj **Cp_max** i **Ct**.  
- Zwiększ/zmniejsz **solidity σ** w środkowej sekcji — szukaj optimum mocy vs ciągu.  
- Podmień profil tip na cieńszy/grubszy — porównaj **L/D** i wpływ na hałas i obciążenia.

### D. Szkic IEC 61400 — mapowanie na praktykę w QBlade (świadomościowo)
- **DLC 1.x** (normalna pracująca turbina, normalna turbulencja) → serię nieustalonych przebiegów w QBlade; sprawdź momenty i odchylenia.  
- **DLC 2.x/3.x** (rozruchy/wyłączenia, awarie) → scenariusze przejściowe: start/stop, awaryjne feathering.  
- **DLC 6.x** (warunki serwisowe) → niskie prędkości, manewry sterowania.  
> QBlade służy tu do **świadomego prototypowania**; pełna certyfikacja wymaga zaawansowanych pakietów aeroelastycznych i obliczeń strukturalnych.

---

## AEP i niepewność — mini-procedura obliczeniowa

1. **Binning wiatru**: podziel rozkład prędkości (z masztu/LiDAR) na koszyki (np. co 0,5 m/s).  
2. **Mapowanie na P(v)**: dla każdego koszyka odczytaj moc z krzywej QBlade.  
3. **Sumowanie energii**: `E = Σ P(v_i) · t_i` (dla każdej klasy prędkości).  
4. **Korekty strat**: zastosuj macierze strat (dostępność, elektryczne, icing, curtailment, wake).  
5. **P50/P90**: dodaj niepewności (kwadraturowo): dane wiatru, model P(v), straty — wyznacz kwantyle.  
6. **Raport**: pokaż **AEP_gross**, **AEP_net**, listę strat i zakres niepewności.

> **Wskazówka:** Zawsze dokumentuj **gęstość powietrza** używaną w QBlade (wysokość, temperatura); to częsty powód rozjazdów AEP.

---

## Przykładowe ćwiczenie (rozszerzone)
**Zadanie:** zaprojektuj wirnik **D ≈ 20 m**, **B=3**, turbina **Rated ≈ 100 kW**, **λ_design ≈ 6–7**.
1. Wybierz 2–3 profile i wygeneruj polary dla **Re = 5e5, 1e6, 2e6** (użyj wspólnego zakresu **α**).  
2. Zaprojektuj **chord(r)** i **twist(r)**. Przygotuj **dwa warianty sterowania** (stały kąt vs pitch).  
3. Wygeneruj **Cp(λ)**, **Ct(λ)**, **P(v)**. Wyznacz **AEP** dla Weibulla *(k=2, c=7 m/s)*.  
4. Przeprowadź **analizę wrażliwości**: zmień **λ_design** o ±10% i porównaj **AEP** oraz maks. **Ct**.  
5. Zbierz wyniki w tabelach/wykresach, opisz wnioski inżynierskie (kompromisy sprawność/obciążenia/hałas).

**Kryteria oceny (rozszerzone):**
- [25%] Jakość danych aerodynamicznych (polary wielo-Re, gładkość, brak artefaktów).  
- [25%] Projekt łopaty i stabilność rozwiązań BEM (ustawienia solvera, korekty).  
- [20%] Krzywe **Cp(λ)**/**P(v)** oraz poprawny export (jednostki, metadane).  
- [15%] Analiza **AEP** i macierzy strat, jasna metodologia.  
- [15%] Analiza wrażliwości i wnioski (zrozumienie kompromisów projektowych).

---

## Dobre praktyki i typowe pułapki
- **Re różne po promieniu**: nie używaj jednej polary „na wszystko”.  
- **Szarpane polary** → niestabilny BEM: popraw wygładzeniem lub poszerz zakreślenie **α**.  
- **Zbyt wysokie Ct**: zmniejsz chord w 0,5–0,8R, podnieś **λ_design** lub łagodniej steruj pitch w rated.  
- **Hałas**: kontroluj **V_tip** i kształt końcówki; unikaj gwałtownych zmian pitch.  
- **Export**: opisuj dokładnie jednostki i gęstość; dołącz ustawienia solvera dla reprodukowalności.  
- **Porządek wersji**: zapisuj warianty z jasnym nazewnictwem (`blade_v3_lambda6p5_pitch.csv`).

---

## Materiały do samodzielnego sprawdzenia (pytania kontrolne)
1. Co oznacza **λ_design** i jak wpływa na rozkłady **chord/twist**?  
2. Dlaczego potrzebujemy **Ct(v)** przy analizie farmy?  
3. Jakie zjawiska obejmuje **dynamic stall** i kiedy ma największe znaczenie?  
4. Jakie są konsekwencje błędnej gęstości powietrza w P(v)?  
5. Co daje korekta **Prandtl tip/root** i dlaczego bez niej przeszacowujemy **Cp**?

---

## Załączniki dydaktyczne

### Załącznik A — Checklista QBlade (UI, krok po kroku)
1. **Airfoils** → import profili (`*.dat`) → weryfikacja geometrii.  
2. **Polars** → ustawienia **Re**, zakres **α** → generacja → wygładzenie.  
3. **Blade Design** → B, R, hub, r_in → przypisanie profili → krzywe **chord/twist**.  
4. **Rotor** → złożenie łopaty → weryfikacja geometrii.  
5. **Turbine** → sterowanie (T–ω poniżej rated, pitch powyżej rated) → prędkości graniczne.  
6. **BEM** → Cp/Ct/P vs λ → P(v).  
7. **Unsteady/Loads** → scenariusze podmuchów/turbulencji.  
8. **Export** → `power_curve.csv`, `thrust_curve.csv` + zapis ustawień solvera.

### Załącznik B — Szablon karty projektu turbiny (do wypełnienia)
- **Parametry wejściowe**: R, B, λ_design, σ, Re (sekcje), cut-in/rated/cut-out, gęstość powietrza.  
- **Profile i polary**: lista profili, zakresy **α**, poziomy **Re**, wykresy **Cl/Cd** i **L/D**.  
- **Geometria łopaty**: tabele **chord(r)**, **twist(r)**, przypisanie profili.  
- **Sterowanie**: prawo **T(ω)**, harmonogram **pitch( V )**.  
- **Wyniki**: wykresy **Cp(λ)**, **Ct(λ)**, **P(v)**; **AEP_gross/net**; matryca strat; uwagi dot. obciążeń.  
- **Niepewność**: źródła i P50/P90.  
- **Wnioski**: decyzje projektowe i rekomendacje.

### Załącznik C — Przykładowe formaty plików
`power_curve.csv` (fragment):
```csv
# density=1.225 kg/m3; R=10 m; B=3; lambda_design=6.5
wind_speed[m/s], power[kW]
3.0, 0.0
3.5, 1.2
...
25.0, 0.0
```
`thrust_curve.csv` (fragment):
```csv
wind_speed[m/s], Ct[-]
3.0, 0.71
3.5, 0.79
...
25.0, 0.05
```

---

### Podsumowanie
W QBlade zaczynamy od **rzetelnych polarnych**, następnie projektujemy **łopatę** i składamy **turbinę**, by otrzymać **krzywą mocy/ciągu** oraz wstępnie ocenić **obciążenia**. Te artefakty stanowią **podstawę** do projektowania **farmy wiatrowej** w dalszych narzędziach. QBlade działa więc jako **„silnik aerodynamiczny”** całego łańcucha — od profilu, przez łopatę i sterowanie, po wejścia do analiz farmowych, AEP i ekonomii.

